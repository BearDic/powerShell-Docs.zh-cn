---
ms.date: 2017-10-12
ms.topic: conceptual
keywords: "dsc,powershell,配置,安装程序"
title: "Windows PowerShell 4.0 Desired State Configuration 本地配置管理器 (LCM)"
ms.openlocfilehash: 6ff8fa75f8ed33dc8da5285373ec1f3858cfa917
ms.sourcegitcommit: a444406120e5af4e746cbbc0558fe89a7e78aef6
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/17/2018
---
# <a name="windows-powershell-40-desired-state-configuration-local-configuration-manager-lcm"></a><span data-ttu-id="ce6bb-103">Windows PowerShell 4.0 Desired State Configuration 本地配置管理器 (LCM)</span><span class="sxs-lookup"><span data-stu-id="ce6bb-103">Windows PowerShell 4.0 Desired State Configuration Local Configuration Manager (LCM)</span></span>

><span data-ttu-id="ce6bb-104">适用于：Windows PowerShell 4.0</span><span class="sxs-lookup"><span data-stu-id="ce6bb-104">Applies To: Windows PowerShell 4.0</span></span>

<span data-ttu-id="ce6bb-105">本地配置管理器是 Windows PowerShell Desired State Configuration (DSC) 引擎。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-105">Local Configuration Manager is the Windows PowerShell Desired State Configuration (DSC) engine.</span></span>
<span data-ttu-id="ce6bb-106">它在所有的目标节点上运行，负责调用 DSC 配置脚本中包含的配置资源。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-106">It runs on all target nodes, and it is responsible for calling the configuration resources that are included in a DSC configuration script.</span></span>
<span data-ttu-id="ce6bb-107">本主题列出了本地配置管理器的属性，并介绍如何在目标节点上修改本地配置管理器设置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-107">This topic lists the properties of Local Configuration Manager and describes how you can modify the Local Configuration Manager settings on a target node.</span></span>

## <a name="local-configuration-manager-properties"></a><span data-ttu-id="ce6bb-108">本地配置管理器属性</span><span class="sxs-lookup"><span data-stu-id="ce6bb-108">Local Configuration Manager properties</span></span>

<span data-ttu-id="ce6bb-109">以下列出了可以设置或检索的本地配置管理器属性。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-109">The following lists the Local Configuration Manager properties that you can set or retrieve.</span></span>

- <span data-ttu-id="ce6bb-110">**AllowModuleOverwrite**：控制是否允许从配置服务下载的新配置覆盖目标节点上的旧配置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-110">**AllowModuleOverwrite**: Controls whether new configurations downloaded from the configuration service are allowed to overwrite the old ones on the target node.</span></span> <span data-ttu-id="ce6bb-111">可能的值为 True 和 False。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-111">Possible values are True and False.</span></span>
- <span data-ttu-id="ce6bb-112">**CertificateID**：用于保护在配置中传递的凭据的证书指纹。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-112">**CertificateID**: The thumbprint of a certificate used to secure credentials passed in a configuration.</span></span> <span data-ttu-id="ce6bb-113">更多详细信息，请参阅 [Want to secure credentials in Windows PowerShell Desired State Configuration?（希望在 Windows PowerShell Desired State Configuration 中保护凭据？）](http://blogs.msdn.com/b/powershell/archive/2014/01/31/want-to-secure-credentials-in-windows-powershell-desired-state-configuration.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-113">For more information see [Want to secure credentials in Windows PowerShell Desired State Configuration?](http://blogs.msdn.com/b/powershell/archive/2014/01/31/want-to-secure-credentials-in-windows-powershell-desired-state-configuration.aspx).</span></span>
- <span data-ttu-id="ce6bb-114">**ConfigurationID**：指示用于从请求服务获取特定配置文件的 GUID。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-114">**ConfigurationID**: Indicates a GUID which is used to get a particular configuration file from a pull service.</span></span> <span data-ttu-id="ce6bb-115">GUID 可确保访问正确的配置文件。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-115">The GUID ensures that the correct configuration file is accessed.</span></span>
- <span data-ttu-id="ce6bb-116">**ConfigurationMode**：指定本地配置管理器实际如何将配置应用到目标节点。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-116">**ConfigurationMode**: Specifies how the Local Configuration Manager actually applies the configuration to the target nodes.</span></span> <span data-ttu-id="ce6bb-117">可以有下列值：</span><span class="sxs-lookup"><span data-stu-id="ce6bb-117">It can take the following values:</span></span>
  - <span data-ttu-id="ce6bb-118">**ApplyOnly**：使用此选项，DSC 将应用配置，但在检测到新配置之前不会执行任何进一步操作。检测新配置的方式可以是向目标节点直接发送新配置；也可以是连接请求服务后，DSC 检查请求服务时发现新配置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-118">**ApplyOnly**: With this option, DSC applies the configuration and does nothing further unless a new configuration is detected, either by you sending a new configuration directly to the target node or if you are connecting to a pull service and DSC discovers a new configuration when it checks with the pull service.</span></span> <span data-ttu-id="ce6bb-119">如果目标节点的配置偏离，则不执行任何操作。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-119">If the target node’s configuration drifts, no action is taken.</span></span>
  - <span data-ttu-id="ce6bb-120">**ApplyAndMonitor**：使用此选项（默认），DSC 会应用任何由你直接发送到目标节点的或者在请求服务上发现的新配置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-120">**ApplyAndMonitor**: With this option (which is the default), DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span> <span data-ttu-id="ce6bb-121">此后，如果目标节点的配置偏离配置文件，DSC 将在日志中报告差异。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-121">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs.</span></span> <span data-ttu-id="ce6bb-122">有关 DSC 日志记录的详细信息，请参阅 [Using Event Logs to Diagnose Errors in Desired State Configuration（在 Desired State Configuration 中使用事件日志诊断错误）](http://blogs.msdn.com/b/powershell/archive/2014/01/03/using-event-logs-to-diagnose-errors-in-desired-state-configuration.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-122">For more about DSC logging, see [Using Event Logs to Diagnose Errors in Desired State Configuration](http://blogs.msdn.com/b/powershell/archive/2014/01/03/using-event-logs-to-diagnose-errors-in-desired-state-configuration.aspx).</span></span>
  - <span data-ttu-id="ce6bb-123">**ApplyAndAutoCorrect**：使用此选项，DSC 会应用任何由你直接发送到目标节点的或者在请求服务上发现的新配置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-123">**ApplyAndAutoCorrect**: With this option, DSC applies any new configurations, whether sent by you directly to the target node or discovered on a pull service.</span></span> <span data-ttu-id="ce6bb-124">此后，如果目标节点的配置偏离配置文件，DSC 将在日志中报告差异，并尝试调整目标节点配置，使其与配置文件相容。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-124">Thereafter, if the configuration of the target node drifts from the configuration file, DSC reports the discrepancy in logs, and then attempts to adjust the target node configuration to bring in compliance with the configuration file.</span></span>
- <span data-ttu-id="ce6bb-125">**ConfigurationModeFrequencyMins**：表示 DSC 的后台应用程序尝试在目标节点上执行当前配置的频率（以分钟为单位）。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-125">**ConfigurationModeFrequencyMins**: Represents the frequency (in minutes) at which the background application of DSC attempts to implement the current configuration on the target node.</span></span> <span data-ttu-id="ce6bb-126">默认值为 15。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-126">The default value is 15.</span></span> <span data-ttu-id="ce6bb-127">可将此值设置为与 RefreshMode 结合使用。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-127">This value can be set in conjunction with RefreshMode.</span></span> <span data-ttu-id="ce6bb-128">当 RefreshMode 设置为 PULL 时，目标节点按 RefreshFrequencyMins 所设置的时间间隔与配置服务联系并下载当前配置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-128">When RefreshMode is set to PULL, the target node contacts the configuration service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="ce6bb-129">无论 RefreshMode 值如何，一致性引擎都会在由 ConfigurationModeFrequencyMins 设置的时间间隔将下载的最新配置应用到目标节点。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-129">Regardless of the RefreshMode value, at the interval set by ConfigurationModeFrequencyMins, the consistency engine applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="ce6bb-130">RefreshFrequencyMins 应设置为 ConfigurationModeFrequencyMins 的整倍数。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-130">RefreshFrequencyMins should be set to an integer multiple of ConfigurationModeFrequencyMins.</span></span>
- <span data-ttu-id="ce6bb-131">**Credential**：指示访问远程资源（例如联系配置服务）所需的凭据（与 Get-Credential 相同）。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-131">**Credential**: Indicates credentials (as with Get-Credential) required to access remote resources, such as to contact the configuration service.</span></span>
- <span data-ttu-id="ce6bb-132">**DownloadManagerCustomData**：表示包含特定于下载管理器的自定义数据的数组。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-132">**DownloadManagerCustomData**: Represents an array that contains custom data specific to the download manager.</span></span>
- <span data-ttu-id="ce6bb-133">**DownloadManagerName**：指示配置和模块下载管理器的名称。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-133">**DownloadManagerName**: Indicates the name of the configuration and module download manager.</span></span>
- <span data-ttu-id="ce6bb-134">**RebootNodeIfNeeded**：目标节点上的某些配置更改可能要求重启该节点才能应用这些更改。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-134">**RebootNodeIfNeeded**: Certain configuration changes on a target node might require it to be restarted for the changes to be applied.</span></span> <span data-ttu-id="ce6bb-135">如果值为 **True**，则此属性将在配置应用完成后立即重启节点，而不会发出进一步警告。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-135">With the value **True**, this property will restart the node as soon as the configuration has been completely applies, without further warning.</span></span> <span data-ttu-id="ce6bb-136">如果值为 **False**（默认值），则将完成配置，但必须手动重启节点才能使更改生效。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-136">If **False** (the default value), the configuration will be completed, but the node must be restarted manually for the changes to take effect.</span></span>
- <span data-ttu-id="ce6bb-137">**RefreshFrequencyMins**：设置请求服务后使用。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-137">**RefreshFrequencyMins**: Used when you have set up a pull service.</span></span> <span data-ttu-id="ce6bb-138">表示本地配置管理器联系请求服务下载当前配置的频率（以分钟为单位）。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-138">Represents the frequency (in minutes) at which the Local Configuration Manager contacts a pull service to download the current configuration.</span></span> <span data-ttu-id="ce6bb-139">可将此值设置为与 ConfigurationModeFrequencyMins 结合使用。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-139">This value can be set in conjunction with ConfigurationModeFrequencyMins.</span></span> <span data-ttu-id="ce6bb-140">当 RefreshMode 设置为 PULL 时，目标节点按 RefreshFrequencyMins 所设置的时间间隔与请求服务联系并下载当前配置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-140">When RefreshMode is set to PULL, the target node contacts the pull service at an interval set by RefreshFrequencyMins and downloads the current configuration.</span></span> <span data-ttu-id="ce6bb-141">一致性引擎将在由 ConfigurationModeFrequencyMins 设置的时间间隔将下载的最新配置应用到目标节点。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-141">At the interval set by ConfigurationModeFrequencyMins, the consistency engine then applies the latest configuration that was downloaded to the target node.</span></span> <span data-ttu-id="ce6bb-142">若 RefreshFrequencyMins 未设置为 ConfigurationModeFrequencyMins 的整倍数，系统将会向上进行舍入。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-142">If RefreshFrequencyMins is not set to an integer multiple of ConfigurationModeFrequencyMins, the system will round it up.</span></span> <span data-ttu-id="ce6bb-143">默认值为 30。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-143">The default value is 30.</span></span>
- <span data-ttu-id="ce6bb-144">**RefreshMode**：可能的值为 **Push**（默认值）和 **Pull**。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-144">**RefreshMode**: Possible values are **Push** (the default) and **Pull**.</span></span> <span data-ttu-id="ce6bb-145">在“推送”配置下，必须在每个目标节点上放置配置文件（可使用任何客户端计算机进行此操作）。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-145">In the “push” configuration, you must place a configuration file on each target node, using any client computer.</span></span> <span data-ttu-id="ce6bb-146">在“请求”模式下，必须为本地配置管理器设置请求服务，以便其联系和访问配置文件。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-146">In the “pull” mode, you must set up a pull service for Local Configuration Manager to contact and access the configuration files.</span></span>

### <a name="example-of-updating-local-configuration-manager-settings"></a><span data-ttu-id="ce6bb-147">更新本地配置管理器设置的示例</span><span class="sxs-lookup"><span data-stu-id="ce6bb-147">Example of updating Local Configuration Manager settings</span></span>

<span data-ttu-id="ce6bb-148">可以通过在节点块内包含 **LocalConfigurationManager** 块来更新目标节点的本地配置管理器设置，如以下示例中所示。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-148">You can update the Local Configuration Manager settings of a target node by including a **LocalConfigurationManager** block inside the node block in a configuration script, as shown in the following example.</span></span>

```powershell
Configuration ExampleConfig
{
    Node “Server001”
    {
        LocalConfigurationManager
        {
            ConfigurationID = "646e48cb-3082-4a12-9fd9-f71b9a562d4e"
            ConfigurationModeFrequencyMins = 45
            ConfigurationMode = "ApplyAndAutocorrect"
            RefreshMode = "Pull"
            RefreshFrequencyMins = 90
            DownloadManagerName = "WebDownloadManager"
            DownloadManagerCustomData = (@{ServerUrl="https://$PullService/psdscpullserver.svc"})
            CertificateID = "71AA68562316FE3F73536F1096B85D66289ED60E"
            Credential = $cred
            RebootNodeIfNeeded = $true
            AllowModuleOverwrite = $false
        }
# One or more resource blocks can be added here
    }
}

# The following line invokes the configuration and creates a file called Server001.meta.mof at the specified path
ExampleConfig -OutputPath "c:\users\public\dsc"
```

<span data-ttu-id="ce6bb-149">运行以上示例中的脚本将生成一个 MOF 文件，它指定并存储了所需设置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-149">Running the script in the previous example generates a MOF file that specifies and stores the desired settings.</span></span>
<span data-ttu-id="ce6bb-150">若要应用这些设置，可以使用 **Set-DscLocalConfigurationManager** cmdlet，如以下示例中所示。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-150">To apply the settings, you can use the **Set-DscLocalConfigurationManager** cmdlet, as shown in the following example.</span></span>

```powershell
Set-DscLocalConfigurationManager -Path "c:\users\public\dsc"
```

> <span data-ttu-id="ce6bb-151">**注意**：调用以上示例中的配置时，必须为 **Path** 参数指定与 **OutputPath** 参数相同的路径。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-151">**Note**: For the **Path** parameter, you must specify the same path that you specified for the **OutputPath** parameter when you invoked the configuration in the previous example.</span></span>

<span data-ttu-id="ce6bb-152">若要查看当前本地配置管理器设置，可以使用 **Get-DscLocalConfigurationManager** cmdlet。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-152">To see the current Local Configuration Manager settings, you can use the **Get-DscLocalConfigurationManager** cmdlet.</span></span>
<span data-ttu-id="ce6bb-153">如果不带任何参数调用此 cmdlet，默认情况下它将获取其运行于的节点上的本地配置管理器设置。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-153">If you invoke this cmdlet with no parameters, by default it will get the Local Configuration Manager settings for the node on which you run it.</span></span>
<span data-ttu-id="ce6bb-154">若要指定另一个节点，请将 **CimSession** 参数用于此 cmdlet。</span><span class="sxs-lookup"><span data-stu-id="ce6bb-154">To specify another node, use the **CimSession** parameter with this cmdlet.</span></span>
