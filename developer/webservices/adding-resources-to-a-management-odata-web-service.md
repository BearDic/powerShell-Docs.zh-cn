---
title: 将资源添加到管理 OData Web 服务 |Microsoft Docs
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e620bf6d-76be-47b0-a7a8-f43418f30c60
caps.latest.revision: 6
ms.openlocfilehash: b81a32b867795ae51c3f5308c2f82c31ed2747fa
ms.sourcegitcommit: e7445ba8203da304286c591ff513900ad1c244a4
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "62080775"
---
# <a name="adding-resources-to-a-management-odata-web-service"></a><span data-ttu-id="2a73f-102">向管理 OData Web 服务添加资源</span><span class="sxs-lookup"><span data-stu-id="2a73f-102">Adding Resources to a Management OData Web Service</span></span>

<span data-ttu-id="2a73f-103">此示例演示如何使用管理 OData 架构设计器将资源添加到现有管理 OData web 服务。</span><span class="sxs-lookup"><span data-stu-id="2a73f-103">This example demonstrates how to add a resource to an existing Management OData web service by using the Management OData Schema Designer.</span></span> <span data-ttu-id="2a73f-104">[PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a)示例创建公开的过程和服务器资源的 web 服务。</span><span class="sxs-lookup"><span data-stu-id="2a73f-104">The [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample creates a web service that exposes the Process and Server resources.</span></span> <span data-ttu-id="2a73f-105">在此示例中，会将虚拟机 (VM) 资源添加到 web 服务。</span><span class="sxs-lookup"><span data-stu-id="2a73f-105">In this example, you will add a Virtual Machine (VM) resource to the web service.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2a73f-106">必备条件</span><span class="sxs-lookup"><span data-stu-id="2a73f-106">Prerequisites</span></span>

<span data-ttu-id="2a73f-107">本主题假定你已下载并安装[PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a)示例中所述[创建的 Windows PowerShell Web 服务](./creating-a-management-odata-web-service.md)，并且已下载并安装[管理 OData 架构设计器](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner)。</span><span class="sxs-lookup"><span data-stu-id="2a73f-107">This topic assumes that you have downloaded and installed the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample as described in [Creating a Windows PowerShell Web Service](./creating-a-management-odata-web-service.md), and that you have downloaded and installed the [Management OData Schema Designer](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span></span> <span data-ttu-id="2a73f-108">本主题还假定已在其中设置管理 Odata 终结点的计算机上安装 HYPER-V Windows PowerShell 模块。</span><span class="sxs-lookup"><span data-stu-id="2a73f-108">This topic also assumes that you have the Hyper-V Windows PowerShell module installed on the computer where you set up the Management Odata endpoint.</span></span>

## <a name="adding-vm-as-a-resource-to-the-web-service"></a><span data-ttu-id="2a73f-109">将 VM 作为资源添加到 Web 服务</span><span class="sxs-lookup"><span data-stu-id="2a73f-109">Adding VM as a Resource to the Web Service</span></span>

<span data-ttu-id="2a73f-110">第一步是在架构中导入架构设计器从现有管理 OData 终结点。</span><span class="sxs-lookup"><span data-stu-id="2a73f-110">The first step is to import the schema from the existing Management OData endpoint into the schema designer.</span></span> <span data-ttu-id="2a73f-111">以下过程介绍如何执行该操作。</span><span class="sxs-lookup"><span data-stu-id="2a73f-111">The following procedure describes how to do that.</span></span>

#### <a name="importing-an-existing-schema-into-the-schema-designer"></a><span data-ttu-id="2a73f-112">架构设计器导入现有的架构</span><span class="sxs-lookup"><span data-stu-id="2a73f-112">Importing an existing schema into the schema designer</span></span>

1. <span data-ttu-id="2a73f-113">打开管理 OData 架构设计器。</span><span class="sxs-lookup"><span data-stu-id="2a73f-113">Open the Management OData Schema Designer.</span></span>

2. <span data-ttu-id="2a73f-114">从**文件**菜单中，选择**文件**;**新**;**文件**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-114">From the **File** menu, select **File** ; **New** ; **File**.</span></span> <span data-ttu-id="2a73f-115">**新的文件**此时将显示对话框。</span><span class="sxs-lookup"><span data-stu-id="2a73f-115">The **New File** dialog appears.</span></span>

3. <span data-ttu-id="2a73f-116">单击**管理 OData 模型**，然后单击**打开**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-116">Click **Management OData Model**, and then click **Open**.</span></span>

4. <span data-ttu-id="2a73f-117">在主窗口中，右键单击，然后单击**架构文件**;**导入**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-117">Right-click in the main window, and click **Schema file** ; **Import**.</span></span> <span data-ttu-id="2a73f-118">**打开**此时将显示对话框。</span><span class="sxs-lookup"><span data-stu-id="2a73f-118">The **Open** dialog appears.</span></span>

5. <span data-ttu-id="2a73f-119">导航到在其中设置的管理 OData web 服务的文件夹[PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a)示例。</span><span class="sxs-lookup"><span data-stu-id="2a73f-119">Navigate to the folder where you set up the Management OData web service for the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample.</span></span> <span data-ttu-id="2a73f-120">如果该示例随附的 Windows PowerShell 脚本用于设置终结点，而无需修改脚本，该文件夹是**C:\inetpub\wwwroot\Modata**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-120">If you used the Windows PowerShell script provided with that sample to set up the endpoint without modifying the script, that folder is **C:\inetpub\wwwroot\Modata**.</span></span> <span data-ttu-id="2a73f-121">选择 Schema.mof，然后单击**打开**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-121">Select Schema.mof, and click **Open**.</span></span>

   <span data-ttu-id="2a73f-122">此时，在文本编辑器中，打开 Schema.mof 和 Schema.xml 文件，请注意，它们包含的进程和服务资源的映射。</span><span class="sxs-lookup"><span data-stu-id="2a73f-122">At this point, open the Schema.mof and Schema.xml files in a text editor, and notice that they contain mappings for the Process and Service resources.</span></span> <span data-ttu-id="2a73f-123">Schema.mof 文件使用[Distributed Management Task Force](https://www.dmtf.org/) (DTMF) 托管对象 (MOF) 标准。</span><span class="sxs-lookup"><span data-stu-id="2a73f-123">The Schema.mof file uses [Distributed Management  Task Force](https://www.dmtf.org/) (DTMF) Managed Object (MOF) standard.</span></span> <span data-ttu-id="2a73f-124">Schema.xml 文件使用 XML 架构中所述[资源的映射架构](./resource-mapping-schema.md)。</span><span class="sxs-lookup"><span data-stu-id="2a73f-124">The schema.xml file uses an XML schema that is described in [Resource Mapping Schema](./resource-mapping-schema.md).</span></span>

   <span data-ttu-id="2a73f-125">以下过程介绍如何导入的架构模型中的 HYPER-V cmdlet。</span><span class="sxs-lookup"><span data-stu-id="2a73f-125">The following procedure describes how to import Hyper-V cmdlets in to the schema model.</span></span>

#### <a name="importing-cmdlets-into-the-schema"></a><span data-ttu-id="2a73f-126">Cmdlet 导入架构</span><span class="sxs-lookup"><span data-stu-id="2a73f-126">Importing cmdlets into the schema</span></span>

1. <span data-ttu-id="2a73f-127">右键单击架构设计器窗口的空白区域，然后单击**导入 Cmdlet**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-127">Right-click on a blank area of the schema designer window, and click **Import Cmdlets**.</span></span> <span data-ttu-id="2a73f-128">**Cmdlet 导入向导**此时将显示对话框。</span><span class="sxs-lookup"><span data-stu-id="2a73f-128">The **Cmdlet Import Wizard** dialog appears.</span></span>

2. <span data-ttu-id="2a73f-129">请确保**本地计算机**已选中，然后单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-129">Make sure **Local Computer** is selected, and click **Next**.</span></span>

3. <span data-ttu-id="2a73f-130">请确保选择了已安装 Windows PowerShell 模块，并从下拉列表中选择的 HYPER-V。</span><span class="sxs-lookup"><span data-stu-id="2a73f-130">Make sure that Installed Windows PowerShell Modules is selected, and select Hyper-V from the drop-down list.</span></span> <span data-ttu-id="2a73f-131">单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-131">click **Next**.</span></span> <span data-ttu-id="2a73f-132">单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-132">Click **Next**.</span></span>

4. <span data-ttu-id="2a73f-133">在中**Cmdlet 名词**列表中，选择**VM**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-133">In the **Cmdlet Noun** list, select **VM**.</span></span> <span data-ttu-id="2a73f-134">单击**下一步**</span><span class="sxs-lookup"><span data-stu-id="2a73f-134">Click **Next**</span></span>

5. <span data-ttu-id="2a73f-135">对于此示例中，我们将绑定只有的 Get 和 Delete 命令使用 cmdlet。</span><span class="sxs-lookup"><span data-stu-id="2a73f-135">For this example, we will bind only the Get and Delete commands with cmdlets.</span></span> <span data-ttu-id="2a73f-136">清除**创建**和**更新**复选框，并确保**获取**并**删除**检查对应的复选框。</span><span class="sxs-lookup"><span data-stu-id="2a73f-136">Clear the **CREATE** and **UPDATE** checkboxes, and make sure the **GET** and **DELETE** checkboxes are checked.</span></span> <span data-ttu-id="2a73f-137">请确保`Get-VM`cmdlet 选择了**获取**，和`Remove-VM`cmdlet 用于**删除**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-137">Make sure that the `Get-VM` cmdlet is selected for **GET**, and the `Remove-VM` cmdlet is selected for **DELETE**.</span></span>

6. <span data-ttu-id="2a73f-138">由于 VM cmdlet 的元数据未指定输出类型，需要运行 cmdlet 来指定输出类型。</span><span class="sxs-lookup"><span data-stu-id="2a73f-138">Because the metadata for the VM cmdlets does not specify an output type, you will need to run the cmdlet to specify the output type.</span></span> <span data-ttu-id="2a73f-139">选择**提供输出类型**然后单击**运行 cmdlet**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-139">Select **Provide output type** and click **Run cmdlet**.</span></span> <span data-ttu-id="2a73f-140">**运行 Cmdlet**此时将显示对话框。</span><span class="sxs-lookup"><span data-stu-id="2a73f-140">The **Run Cmdlet** dialog appears.</span></span> <span data-ttu-id="2a73f-141">单击**运行**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-141">Click **Run**.</span></span> <span data-ttu-id="2a73f-142">**CLR 类型**框中填入`VirtualMachine`类型。</span><span class="sxs-lookup"><span data-stu-id="2a73f-142">The **CLR Type** box is populated with the `VirtualMachine` type.</span></span> <span data-ttu-id="2a73f-143">单击**确定**，然后单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-143">Click **OK**, then click **Next**.</span></span>

7. <span data-ttu-id="2a73f-144">默认情况下已选中所有 VirtualMachine 对象的属性。</span><span class="sxs-lookup"><span data-stu-id="2a73f-144">By default, all of the properties of the VirtualMachine object are selected.</span></span> <span data-ttu-id="2a73f-145">您可以清除不希望从 web 服务请求此资源时所返回数据的一部分的任何属性。</span><span class="sxs-lookup"><span data-stu-id="2a73f-145">You can clear any properties that you do not want as part of the data returned when you request this resource from the web service.</span></span> <span data-ttu-id="2a73f-146">单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-146">Click **Next**.</span></span>

8. <span data-ttu-id="2a73f-147">必须选择至少一个要用作键的属性。</span><span class="sxs-lookup"><span data-stu-id="2a73f-147">You must select at least one property to be used as a key.</span></span> <span data-ttu-id="2a73f-148">选择**名称**在列表中，单击**下一步**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-148">Select **Name** in the list, and click **Next**.</span></span>

9. <span data-ttu-id="2a73f-149">下一个窗口，可将管理 OData 资源的属性映射到基础 cmdlet 的属性。</span><span class="sxs-lookup"><span data-stu-id="2a73f-149">The next window allows you to map properties of the Management OData resource to properties of the underlying cmdlets.</span></span> <span data-ttu-id="2a73f-150">该向导默认情况下映射具有相同名称的属性。</span><span class="sxs-lookup"><span data-stu-id="2a73f-150">The wizard maps properties with identical names by default.</span></span> <span data-ttu-id="2a73f-151">例如，`ComputerName`资源的属性将映射到`ComputerName`属性的 cmdlet。</span><span class="sxs-lookup"><span data-stu-id="2a73f-151">For example, the `ComputerName` property of the resource is mapped to the `ComputerName` property of the cmdlets.</span></span>  <span data-ttu-id="2a73f-152">这允许您指定`ComputerName`到 web 服务的请求中的属性并且具有指定的值传递给`Get-VM`cmdlet。</span><span class="sxs-lookup"><span data-stu-id="2a73f-152">This allows you to specify the `ComputerName` property in a request to the web service, and have the value you specify be passed to the `Get-VM` cmdlet.</span></span> <span data-ttu-id="2a73f-153">`Id` 和`Name`还默认映射。</span><span class="sxs-lookup"><span data-stu-id="2a73f-153">`Id` and `Name` are also mapped by default.</span></span>

   10. <span data-ttu-id="2a73f-154">单击**下一步**，然后单击**完成**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-154">Click **Next**, then click **Finish**.</span></span>

       <span data-ttu-id="2a73f-155">现在，将架构设计器窗口中显示 VM 资源。</span><span class="sxs-lookup"><span data-stu-id="2a73f-155">The VM resource now appears in the schema designer window.</span></span> <span data-ttu-id="2a73f-156">您可以检查的属性和与资源相关联的操作。</span><span class="sxs-lookup"><span data-stu-id="2a73f-156">You can examine the properties and operations associated with the resource.</span></span> <span data-ttu-id="2a73f-157">接下来，你将更新的架构文件导出到 web 服务的虚拟目录。</span><span class="sxs-lookup"><span data-stu-id="2a73f-157">Next, you will export the updated schema files into the virtual directory for the web service.</span></span>

#### <a name="exporting-schema-files-from-the-schema-designer"></a><span data-ttu-id="2a73f-158">从架构设计器导出架构文件</span><span class="sxs-lookup"><span data-stu-id="2a73f-158">Exporting schema files from the schema designer</span></span>

1. <span data-ttu-id="2a73f-159">右键单击架构设计器窗口的空白区域，然后单击**架构文件**;**导出**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-159">Right-click on a blank area of the schema designer window, and click **Schema file** ; **Export**.</span></span> <span data-ttu-id="2a73f-160">**另存为**此时将显示对话框。</span><span class="sxs-lookup"><span data-stu-id="2a73f-160">The **Save As** dialog appears.</span></span>

2. <span data-ttu-id="2a73f-161">您可以导入 MOF 文件中导航到同一个目录。</span><span class="sxs-lookup"><span data-stu-id="2a73f-161">Navigate to the same directory from where you imported the MOF file.</span></span> <span data-ttu-id="2a73f-162">命名该文件与原始的 MOF 文件 (默认情况下的 Schema.mof) 相同，然后单击**保存**。</span><span class="sxs-lookup"><span data-stu-id="2a73f-162">Name the file the same as the original MOF file (Schema.mof by default), and click **Save**.</span></span> <span data-ttu-id="2a73f-163">确认你想要覆盖现有文件。</span><span class="sxs-lookup"><span data-stu-id="2a73f-163">Confirm that you want to overwrite the existing file.</span></span>

   <span data-ttu-id="2a73f-164">虽然未显式指定在**另存为**对话框中，这会替换 Schema.mof 和 Schema.xml 文件。</span><span class="sxs-lookup"><span data-stu-id="2a73f-164">Although it is not explicitly stated in the **Save As** dialog, this replaces both the Schema.mof and Schema.xml files.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2a73f-165">后续步骤</span><span class="sxs-lookup"><span data-stu-id="2a73f-165">Next Steps</span></span>

<span data-ttu-id="2a73f-166">从管理 OData web 服务访问新的 VM 资源之前，必须更新 RbacConfiguration.xml 文件以允许访问 HYPER-V Windows PowerShell 模块，如中所述[基于配置的角色的授权](./configuring-role-based-authorization.md)，并且还需要重新启动 web 服务。</span><span class="sxs-lookup"><span data-stu-id="2a73f-166">Before you access the new VM resource from the Management OData web service, you must update the RbacConfiguration.xml file to allow access to the Hyper-V Windows PowerShell module as described in [Configuring Role-based Authorization](./configuring-role-based-authorization.md), and you will also need to restart the web service.</span></span>